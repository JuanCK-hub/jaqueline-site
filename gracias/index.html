<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gracias - Jaqueline Mart√≠nez Interiorismo Consciente</title>
    <link rel="icon" type="image/png" href="/assets/logos/5.png">
     <meta property="og:title" content="Gracias | Interiorismo Jaqueline Martinez - Checkout">
  <meta property="og:description" content="Pagina de agradecimiento por completar el proceso de checkout de servicios de dise√±o interior y neuroarquitectura de Jaqueline Mart√≠nez Dise√±o Interior en Espa√±a y Colombia.">
  <meta property="og:image" content="assets/logos/image.png">
  <meta property="og:url" content="https://jaquelinemartinez.com/FormCheckout/index.html">
  <link rel="icon" type="image/png" href="/assets/logos/5.png">
   <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5HQR3HHX');</script>
<!-- End Google Tag Manager -->

  <title>Gracias  | Jaqueline Mart√≠nez Dise√±o Interior</title>
    <link rel="canonical" href="https://jaquelinemartinez.com/gracias/index.html" />
    <link rel="stylesheet" href= "/assets/css/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,opsz,wght@0,6..96,400..900;1,6..96,400..900&family=Pinyon+Script&display=swap" rel="stylesheet">

  </head>
  <body>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5HQR3HHX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

     
    
      <main class="main--gracias--container">

    <section class="main--gracias">

      <h1 class="main--gracias__title" id="payment-status"> 
        <strong >Verificando tu pago...</strong>
      </h1>

      <p id="payment-status-detail" class="main--gracias__message" style="display:none;"></p>

      <h3 class="main--gracias__message" id="thanksMsg1">
        Esto puede tardar unos segundos. No cierres esta p√°gina.
      </h3>

      <h3 class="main--gracias__message" id="thanksMsg2"></h3>
      <h3 class="main--gracias__message" id="thanksMsg3"></h3>
      <a href="/portafolio/main.html" class="main--gracias__button" id="thanksCta" style="display:none;">Explorar m√°s proyectos</a>

      <div class="header-gracias__container">
        

       
         <div class="header-gracias__logo--wrapper"> 
          <a href="/index.html">
        <img src="/assets/logos/5.png" alt="Logo Jaqueline Martinez Dise√±o Interior" class="header-gracias__logo">
        </a>
      </div>

      <div class="header-gracias__logo--wrapper">
          <a href="/index.html">
        <img src="/assets/logos/8.png" alt="Logo Jaqueline Martinez Dise√±o Interior" class="header-gracias__logo--2">
        </a>
         </div>

      </div>

    </section>

    </main>

     <footer class="footer">
  <div class="footer-container">

    <nav class="footer-nav">
      <div class="inside-of">
      <a href="/nosotros/index.html" class="bigger">NOSOTROS</a>
      <a href="/nosotros/index.html">Nuestra esencia</a>
      <a href="/nosotros/index.html#nuestro-equipo">Nuestro equipo</a>
      </div>
      <div class="inside-of">
      <a href="/servicios/index.html" class="bigger">SERVICIOS</a>
      <a href="/servicios/index.html">Dise√±o integral</a>
      <a href="/servicios/index.html">Decoracion ligera</a>
      <a href="/servicios/index.html">Transformacion arquitectonica</a>
      <a href="https://jaquelinemartinez.mitiendanikken.com/">Nikken</a>
     
      </div>
      <div class="inside-of">
      <a href="/portafolio/main.html" class="bigger">PORTAFOLIO</a>
      <a href="/index.html#nuevos-proyectos">Nuevos proyectos</a>
      </div>
      <div class="inside-of">
      <a href="/contacto/index.html" class="bigger">CONTACTENOS</a>
      <p>comercial@jaquelinemartinez.com</p>
      </div>
    </nav>
    <img src="/assets/logos/27.png" alt="Logo Jaqueline Martinez Dise√±o Interior" class="footer-logo">
    <p class="footer-copy">Interiorismo, decoradores de interiores, y fabricantes de muebles en Colombia y Espa√±a</p>
    <p class="footer-copy">Via Dos Castillas 33 - √Åtica 4 1 &#124; 28224 Pozuelo de Alarcon &#124; Madrid</p>
    <p class="footer-copy">&copy; 2025 Pagina gestionada por JPJ </p>
    <a class="footer-copy footer-copy--legal" href="/legal/politica-de-privacidad/">Pol√≠tica de Privacidad</a> ¬∑
    <a  class="footer-copy footer-copy--legal" href="/legal/aviso-legal/">Aviso Legal</a>
  </div>
    </footer>
    
   <script>
  (async function () {
    const statusEl = document.getElementById("payment-status");
    const detailEl = document.getElementById("payment-status-detail");

    const msg1 = document.getElementById("thanksMsg1");
    const msg2 = document.getElementById("thanksMsg2");
    const msg3 = document.getElementById("thanksMsg3");
    const cta  = document.getElementById("thanksCta");

    // Helpers UI
    function setVerifying() {
      statusEl.innerHTML = "<strong>Verificando tu pago...</strong>";
      if (detailEl) {
        detailEl.style.display = "none";
        detailEl.textContent = "";
      }
      if (msg1) msg1.textContent = "Esto puede tardar unos segundos. No cierres esta p√°gina.";
      if (msg2) msg2.textContent = "";
      if (msg3) msg3.textContent = "";
      if (cta) cta.style.display = "none"; // üëà oculta CTA mientras verificamos
    }

    function setPaid(email) {
      statusEl.innerHTML = "<strong>¬°Pago confirmado!</strong>";
      if (detailEl) {
        detailEl.style.display = "none";
        detailEl.textContent = "";
      }
      if (msg1) msg1.textContent = "Hemos recibido tu solicitud y nos pondremos en contacto contigo pronto.";
      if (msg2) msg2.textContent = "Nuestro equipo revisar√° la informaci√≥n y se pondr√° en contacto contigo.";
      if (msg3) msg3.textContent = "Te contactaremos en un plazo de 24 a 48 horas.";
      if (cta) cta.style.display = "inline-flex";

      // (Opcional) si quieres mostrar el email:
      // if (msg3 && email) msg3.textContent += ` (Confirmaci√≥n enviada a: ${email})`;
    }

    function setPending(payment_status, status) {
      statusEl.innerHTML = "<strong>Pago en proceso‚Ä¶</strong>";
      if (detailEl) {
        detailEl.style.display = "block";
        detailEl.textContent = `Estado: ${payment_status || "?"} / ${status || "?"}`;
      }
      if (msg1) msg1.textContent = "Estamos esperando confirmaci√≥n del pago.";
      if (msg2) msg2.textContent = "Si tarda m√°s de 1 minuto, revisa tu correo o cont√°ctanos.";
      if (msg3) msg3.textContent = "";
      if (cta) cta.style.display = "none";
    }

    function setFail(msg) {
      statusEl.innerHTML = "<strong>No pudimos verificar tu pago.</strong>";
      if (detailEl) {
        detailEl.style.display = "block";
        detailEl.textContent = msg || "Intenta de nuevo o cont√°ctanos.";
      }
      if (msg1) msg1.textContent = "Si ya pagaste, no te preocupes: podemos confirmar manualmente.";
      if (msg2) msg2.textContent = "Escr√≠benos a comercial@jaquelinemartinez.com con tu correo y la hora del pago.";
      if (msg3) msg3.textContent = "";
      if (cta) cta.style.display = "inline-flex"; // o "none" si prefieres ocultarlo
    }

    // --- Arranque UI
    setVerifying();

    // --- Lee session_id
    const params = new URLSearchParams(window.location.search);
    const sessionId = params.get("session_id");

    if (!sessionId) {
      setFail("Falta session_id en la URL. (Stripe no devolvi√≥ el par√°metro)");
      return;
    }

    // Endpoint Netlify
    const endpoint = `/.netlify/functions/get-session-status?session_id=${encodeURIComponent(sessionId)}`;

    // Polling: intenta varias veces por si Stripe tarda
    const MAX_TRIES = 12;     // 12 intentos
    const WAIT_MS = 1500;     // cada 1.5s (total ~18s)

    for (let i = 1; i <= MAX_TRIES; i++) {
      try {
        const res = await fetch(endpoint, { cache: "no-store" });

        // Si Netlify devuelve HTML/404, esto lo detecta
        const contentType = res.headers.get("content-type") || "";
        const rawText = await res.text();

        let data = null;
        if (contentType.includes("application/json")) {
          data = JSON.parse(rawText);
        } else {
          // No es JSON -> probablemente 404/HTML
          if (!res.ok) {
            setFail(`Backend no respondi√≥ JSON (HTTP ${res.status}).`);
            return;
          }
          // Si fuese 200 pero no JSON (raro), tambi√©n falla:
          setFail("Respuesta inesperada del backend (no JSON).");
          return;
        }

        if (!res.ok) {
          // error JSON del backend
          setFail(data?.error || "Error del servidor verificando el pago.");
          return;
        }

        const paid = data.payment_status === "paid" && data.status === "complete";

        if (paid) {
          setPaid(data.customer_email);
          return;
        }

        // Si todav√≠a no est√° pagado/complete, muestra pending y sigue intentando
        setPending(data.payment_status, data.status);

      } catch (e) {
        // Error de red / parse
        if (i === MAX_TRIES) {
          setFail(e.message);
          return;
        }
      }

      // espera antes del siguiente intento
      await new Promise(r => setTimeout(r, WAIT_MS));
    }

    // Si llega aqu√≠: no confirm√≥ a tiempo
    setFail("No se pudo confirmar el pago a tiempo. Si pagaste, cont√°ctanos.");
  })();
</script>

  

  </body>
</html>